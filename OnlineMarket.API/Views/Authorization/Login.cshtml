@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">
    <!-- Stylesheet -->
    <link rel="stylesheet" href="~/login.css">
    <title>Вход</title>
    <script src="https://yastatic.net/s3/passport-sdk/autofill/v1/sdk-suggest-with-polyfills-latest.js"></script>
</head>
<body>
    <div class="background"></div>
    <form action="/Authorization/Login" method="post" class="login-form">
        <h3>Войти</h3>

        <!-- Блок для отображения ошибок -->
        @if (ViewData["ErrorMessage"] != null)
        {
            <div class="error-message">
                <p>@ViewData["ErrorMessage"]</p>
            </div>
        }

        <label for="username">Логин</label>
        <input type="text" placeholder="Логин" name="Username" id="username">

        <label for="password">Пароль</label>
        <input type="password" placeholder="Пароль" name="Password" id="password">

        <div class="reg-button">
            <button type="submit">Войти</button>
        </div>

        <div class="reg-button">
            <a href="/Authorization/Register" target="_blank">Регистрация</a>
        </div>
    </form>

    <!-- Social login icons -->
    <div class="social">
        <div id="buttonContainerId"></div>
    </div>

    <script>
        window.YaAuthSuggest.init(
            {
                client_id: "818138e68e80463b8cbd7f0defa29be8",  // Ваш client_id
                response_type: "token",
                redirect_uri: "http://magazin.somee.com/Authorization/AuthenticateWithYandex"
            },
            "https://oauth.yandex.ru",
            {
                view: "button",  // Тип отображения кнопки
                parentId: "buttonContainerId",  // Контейнер, в который будет вставлена кнопка
                buttonSize: 'l',  // Размер кнопки
                buttonView: 'iconBg',  // Тип кнопки с иконкой
                buttonTheme: 'dark',  // Тема кнопки
                buttonBorderRadius: "0",  // Скругление углов
                buttonIcon: 'ya',  // Иконка кнопки (языковая иконка Яндекс)
            }
        )
        .then(({handler}) => {
            console.log('Инициализация прошла успешно, подключение обработчика');
            const yaButton = document.getElementById('buttonContainerId');
            if (yaButton) {
                yaButton.addEventListener('click', function() {
                    console.log('Кнопка Яндекс нажата');
                    handler().then(data => {
                        console.log('Ответ от Яндекса:', data);  // Логируем ответ от Яндекса
                        if (data && data.access_token) {
                            console.log('Токен получен:', data.access_token);
                            // Перенаправляем на сервер с токеном
                            window.location.href = `/Authorization/AuthenticateWithYandex?token=${data.access_token}`;
                        } else {
                            console.log('Ошибка: Токен не получен');
                        }
                    }).catch(error => {
                        console.log('Ошибка авторизации через Яндекс:', error);
                    });
                });
            } else {
                console.log('Кнопка Яндекс не найдена');
            }
        })
        .catch(error => {
            console.log('Ошибка инициализации Яндекс авторизации:', error);
        });
    </script>
</body>
</html>
